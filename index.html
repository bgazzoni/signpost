<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>3D Signpost — Game (with COUNTRY_COORDINATES)</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap');
    html,body { height:100%; margin:0; }
    body { overflow:hidden; font-family: 'Bebas Neue', sans-serif; }
    canvas { display:block; }
    #ui { position: absolute; left: 50%; transform: translateX(-50%); bottom: 18px; display: flex; gap: 10px; align-items: center; z-index: 10; }
    #guessInput { width: 260px; padding: 12px 14px; border-radius: 10px; border: 2px solid #5d5f7c; background: rgba(255,255,255,0.03); color: #fff; font-family: 'Bebas Neue', sans-serif; font-size: 18px; text-align: center; outline: none; }
    #guessButton, #playAgainButton { padding: 12px 18px; border-radius: 10px; border: 2px solid #5d5f7c; background: #5d5f7c; color: #fff; font-family: 'Bebas Neue', sans-serif; font-size: 18px; cursor: pointer; }
    #suggestions { position: absolute; bottom: 65px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.9); border: 1px solid #5d5f7c; border-radius: 6px; max-height: 220px; overflow-y: auto; color: #fff; font-size: 16px; display: none; z-index: 11; min-width: 260px; }
    #suggestions div { padding: 6px 10px; cursor: pointer; }
    #suggestions div:hover { background: rgba(255,255,255,0.05); }
    #attempts { background: rgba(0,0,0,0.25); padding: 8px 12px; border-radius: 10px; color: #fff; border: 1px solid rgba(255,255,255,0.03); font-size: 14px; display: none; }
    #message { position: absolute; top: 18px; left: 50%; transform: translateX(-50%); color: #fff; background: rgba(0,0,0,0.35); padding: 8px 12px; border-radius: 8px; font-size: 14px; z-index: 10; pointer-events: none; display: none; }
    #playAgainButton {display: none;}
  </style>
</head>
<body>
  <div id="ui">
    <input id="guessInput" type="text" placeholder="Type a country..." autocomplete="off" />
    <button id="guessButton">Guess</button>
    <button id="playAgainButton">Play Again</button>
    <div id="attempts">Revealed: <span id="revealedCount">1</span> / <span id="maxCount">10</span></div>
  </div>
  <div id="suggestions" role="listbox" aria-label="Country suggestions"></div>
  <div id="message">Guess the country where the pole is located.</div>

  <script type="module">
    import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.module.js';
// --- Basic scene ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color('#222033');
    const camera = new THREE.PerspectiveCamera(45, innerWidth/innerHeight, 0.1, 2000);
    camera.position.set(0,1.6,9);
    camera.lookAt(0,1.6,0);
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(window.devicePixelRatio || 1);
    renderer.setSize(innerWidth, innerHeight);
    document.body.appendChild(renderer.domElement);

    const hemi = new THREE.HemisphereLight(0xffffff,0x808080,0.7); hemi.position.set(0,20,0); scene.add(hemi);
    const dir = new THREE.DirectionalLight(0xffffff,0.8); dir.position.set(5,10,7); scene.add(dir);

    const root = new THREE.Group(); scene.add(root);

    
    // post
    const post = new THREE.Mesh(new THREE.CylinderGeometry(0.12,0.12,7.5,20), new THREE.MeshStandardMaterial({color:0x222033}));  
    root.add(post);

    // grid + fog
    const gridHelper = new THREE.GridHelper(2000,2000,0x40e0d0,0x40e0d0); gridHelper.material.opacity=0.3; gridHelper.material.transparent=true; gridHelper.position.y=-3.05; scene.add(gridHelper);    
    scene.fog = new THREE.FogExp2(0x222033,0.03);

   // --- Text + flag helpers ---
    function makeTextTexture(line1,line2,w=1024,h=256,color1='#222033',color2='#5d5f7c',align='left'){
      const canvas=document.createElement('canvas'); canvas.width=w; canvas.height=h; const ctx=canvas.getContext('2d');
      ctx.clearRect(0,0,w,h);
      const fontSize=Math.round(h*0.36); ctx.font = fontSize + 'px "Bebas Neue"'; ctx.textAlign=align; ctx.textBaseline='middle';
      const lineSpacing = fontSize * 0.5; ctx.fillStyle=color1; ctx.fillText(line1, align==='left'?0: w, h/2-lineSpacing); ctx.fillStyle=color2; ctx.fillText(line2, align==='left'?0: w, h/2+fontSize*1.1-lineSpacing);
      const tex=new THREE.CanvasTexture(canvas); tex.needsUpdate=true; return {tex,fontSize};
    }

    function createFlagCircleTexture(url,diam,cb){ const img=new Image(); img.crossOrigin='anonymous'; img.onload=()=>{ const c=document.createElement('canvas'); c.width=c.height=diam; const ctx=c.getContext('2d'); const size=Math.min(img.width,img.height); const sx=(img.width-size)/2, sy=(img.height-size)/2; ctx.beginPath(); ctx.arc(diam/2,diam/2,diam/2-1.5,0,Math.PI*2); ctx.closePath(); ctx.clip(); ctx.drawImage(img,sx,sy,size,size,0,0,diam,diam); ctx.lineWidth=3; ctx.strokeStyle='#222033'; ctx.beginPath(); ctx.arc(diam/2,diam/2,diam/2-1.5,0,Math.PI*2); ctx.closePath(); ctx.stroke(); const tex=new THREE.CanvasTexture(c); tex.needsUpdate=true; cb(tex); }; img.onerror=()=>{ cb(null); }; img.src=url; }

    // Map country names to ISO codes (partial example — should be extended for all customCountries)
    const countryToISO = { 'AFGHANISTAN': 'af', 'ALBANIA': 'al', 'ALGERIA': 'dz', 'ANDORRA': 'ad', 'ANGOLA': 'ao', 'ANTIGUA AND BARBUDA': 'ag', 'ARGENTINA': 'ar', 'ARMENIA': 'am', 'AUSTRALIA': 'au', 'AUSTRIA': 'at', 'AZERBAIJAN': 'az', 'BAHAMAS': 'bs', 'BAHRAIN': 'bh', 'BANGLADESH': 'bd', 'BARBADOS': 'bb', 'BELARUS': 'by', 'BELGIUM': 'be', 'BELIZE': 'bz', 'BENIN': 'bj', 'BHUTAN': 'bt', 'BOLIVIA': 'bo', 'BOSNIA AND HERZEGOVINA': 'ba', 'BOTSWANA': 'bw', 'BRAZIL': 'br', 'BRUNEI': 'bn', 'BULGARIA': 'bg', 'BURKINA FASO': 'bf', 'BURUNDI': 'bi', 'CABO VERDE': 'cv', 'CAMBODIA': 'kh', 'CAMEROON': 'cm', 'CANADA': 'ca', 'CENTRAL AFRICAN REPUBLIC': 'cf', 'CHAD': 'td', 'CHILE': 'cl', 'CHINA': 'cn', 'COLOMBIA': 'co', 'COMOROS': 'km', 'CONGO': 'cg', 'COSTA RICA': 'cr', 'CROATIA': 'hr', 'CUBA': 'cu', 'CYPRUS': 'cy', 'CZECHIA': 'cz', 'DENMARK': 'dk', 'DJIBOUTI': 'dj', 'DOMINICA': 'dm', 'DOMINICAN REPUBLIC': 'do', 'DR CONGO': 'cd', 'ECUADOR': 'ec', 'EGYPT': 'eg', 'EL SALVADOR': 'sv', 'EQUATORIAL GUINEA': 'gq', 'ERITREA': 'er', 'ESTONIA': 'ee', 'ESWATINI': 'sz', 'ETHIOPIA': 'et', 'FIJI': 'fj', 'FINLAND': 'fi', 'FRANCE': 'fr', 'GABON': 'ga', 'GAMBIA': 'gm', 'GEORGIA': 'ge', 'GERMANY': 'de', 'GHANA': 'gh', 'GREECE': 'gr', 'GRENADA': 'gd', 'GUATEMALA': 'gt', 'GUINEA': 'gn', 'GUINEA-BISSAU': 'gw', 'GUYANA': 'gy', 'HAITI': 'ht', 'HONDURAS': 'hn', 'HUNGARY': 'hu', 'ICELAND': 'is', 'INDIA': 'in', 'INDONESIA': 'id', 'IRAN': 'ir', 'IRAQ': 'iq', 'IRELAND': 'ie', 'ISRAEL': 'il', 'ITALY': 'it', 'IVORY COAST': 'ci', 'JAMAICA': 'jm', 'JAPAN': 'jp', 'JORDAN': 'jo', 'KAZAKHSTAN': 'kz', 'KENYA': 'ke', 'KIRIBATI': 'ki', 'KUWAIT': 'kw', 'KYRGYZSTAN': 'kg', 'LAOS': 'la', 'LATVIA': 'lv', 'LEBANON': 'lb', 'LESOTHO': 'ls', 'LIBERIA': 'lr', 'LIBYA': 'ly', 'LIECHTENSTEIN': 'li', 'LITHUANIA': 'lt', 'LUXEMBOURG': 'lu', 'MADAGASCAR': 'mg', 'MALAWI': 'mw', 'MALAYSIA': 'my', 'MALDIVES': 'mv', 'MALI': 'ml', 'MALTA': 'mt', 'MARSHALL ISLANDS': 'mh', 'MAURITANIA': 'mr', 'MAURITIUS': 'mu', 'MEXICO': 'mx', 'MICRONESIA': 'fm', 'MOLDOVA': 'md', 'MONACO': 'mc', 'MONGOLIA': 'mn', 'MONTENEGRO': 'me', 'MOROCCO': 'ma', 'MOZAMBIQUE': 'mz', 'MYANMAR': 'mm', 'NAMIBIA': 'na', 'NAURU': 'nr', 'NEPAL': 'np', 'NETHERLANDS': 'nl', 'NEW ZEALAND': 'nz', 'NICARAGUA': 'ni', 'NIGER': 'ne', 'NIGERIA': 'ng', 'NORTH KOREA': 'kp', 'NORTH MACEDONIA': 'mk', 'NORWAY': 'no', 'OMAN': 'om', 'PAKISTAN': 'pk', 'PALAU': 'pw', 'PANAMA': 'pa', 'PAPUA NEW GUINEA': 'pg', 'PARAGUAY': 'py', 'PERU': 'pe', 'PHILIPPINES': 'ph', 'POLAND': 'pl', 'PORTUGAL': 'pt', 'QATAR': 'qa', 'ROMANIA': 'ro', 'RUSSIA': 'ru', 'RWANDA': 'rw', 'SAINT KITTS AND NEVIS': 'kn', 'SAINT LUCIA': 'lc', 'SAINT VINCENT AND THE GRENADINES': 'vc', 'SAMOA': 'ws', 'SAN MARINO': 'sm', 'SAO TOME AND PRINCIPE': 'st', 'SAUDI ARABIA': 'sa', 'SENEGAL': 'sn', 'SERBIA': 'rs', 'SEYCHELLES': 'sc', 'SIERRA LEONE': 'sl', 'SINGAPORE': 'sg', 'SLOVAKIA': 'sk', 'SLOVENIA': 'si', 'SOLOMON ISLANDS': 'sb', 'SOMALIA': 'so', 'SOUTH AFRICA': 'za', 'SOUTH KOREA': 'kr', 'SOUTH SUDAN': 'ss', 'SPAIN': 'es', 'SRI LANKA': 'lk', 'SUDAN': 'sd', 'SURINAME': 'sr', 'SWEDEN': 'se', 'SWITZERLAND': 'ch', 'SYRIA': 'sy', 'TAJIKISTAN': 'tj', 'TANZANIA': 'tz', 'THAILAND': 'th', 'TIMOR-LESTE': 'tl', 'TOGO': 'tg', 'TONGA': 'to', 'TRINIDAD AND TOBAGO': 'tt', 'TUNISIA': 'tn', 'TURKEY': 'tr', 'TURKMENISTAN': 'tm', 'TUVALU': 'tv', 'UGANDA': 'ug', 'UKRAINE': 'ua', 'UNITED ARAB EMIRATES': 'ae', 'UNITED KINGDOM': 'gb', 'UNITED STATES': 'us', 'URUGUAY': 'uy', 'UZBEKISTAN': 'uz', 'VANUATU': 'vu', 'VENEZUELA': 've', 'VIETNAM': 'vn', 'YEMEN': 'ye', 'ZAMBIA': 'zm', 'ZIMBABWE': 'zw' };

    function getFlagUrl(country){
      const iso = countryToISO[country.toUpperCase()];
      if(!iso) return null;
      return `https://kapowaz.github.io/square-flags/flags/${iso}.svg`;
    }

    // --- Inserted: COUNTRY_COORDINATES (capitals used as proxy coordinates) ---
    const COUNTRY_COORDINATES = {
        'Afghanistan': { lat: 34.5553, lon: 69.2075 },
        'Albania': { lat: 41.3275, lon: 19.8187 },
        'Algeria': { lat: 36.7538, lon: 3.0583 },
        'Andorra': { lat: 42.5075, lon: 1.5218 },
        'Angola': { lat: -8.8383, lon: 13.2344 },
        'Antigua and Barbuda': { lat: 17.1274, lon: -61.8436 },
        'Argentina': { lat: -34.6037, lon: -58.3816 },
        'Armenia': { lat: 40.1802, lon: 44.5159 },
        'Australia': { lat: -35.2809, lon: 149.1300 },
        'Austria': { lat: 48.2082, lon: 16.3738 },
        'Azerbaijan': { lat: 40.4093, lon: 49.8671 },
        'Bahamas': { lat: 25.0343, lon: -77.3963 },
        'Bahrain': { lat: 26.2285, lon: 50.5860 },
        'Bangladesh': { lat: 23.8103, lon: 90.4125 },
        'Barbados': { lat: 13.1132, lon: -59.5988 },
        'Belarus': { lat: 53.9045, lon: 27.5615 },
        'Belgium': { lat: 50.8503, lon: 4.3517 },
        'Belize': { lat: 17.2510, lon: -88.7690 },
        'Benin': { lat: 6.3658, lon: 2.3853 },
        'Bhutan': { lat: 27.4728, lon: 89.6393 },
        'Bolivia': { lat: -16.5000, lon: -68.1500 },
        'Bosnia and Herzegovina': { lat: 43.8563, lon: 18.4131 },
        'Botswana': { lat: -24.6596, lon: 25.9088 },
        'Brazil': { lat: -15.7939, lon: -47.8828 },
        'Brunei': { lat: 4.9031, lon: 114.9426 },
        'Bulgaria': { lat: 42.6977, lon: 23.3219 },
        'Burkina Faso': { lat: 12.3714, lon: -1.5197 },
        'Burundi': { lat: -3.3822, lon: 29.3644 },
        'Cabo Verde': { lat: 14.9185, lon: -23.5126 },
        'Cambodia': { lat: 11.5564, lon: 104.9221 },
        'Cameroon': { lat: 3.8480, lon: 11.5021 },
        'Canada': { lat: 45.4215, lon: -75.6972 },
        'Central African Republic': { lat: 4.3947, lon: 18.5582 },
        'Chad': { lat: 12.1064, lon: 15.0069 },
        'Chile': { lat: -33.4489, lon: -70.6693 },
        'China': { lat: 39.9042, lon: 116.4074 },
        'Colombia': { lat: 4.7110, lon: -74.0721 },
        'Comoros': { lat: -11.7083, lon: 43.2575 },
        'Congo': { lat: -4.2600, lon: 15.2831 },
        'Costa Rica': { lat: 9.9281, lon: -84.0907 },
        'Croatia': { lat: 45.8150, lon: 15.9819 },
        'Cuba': { lat: 23.1136, lon: -82.3589 },
        'Cyprus': { lat: 35.1856, lon: 33.3823 },
        'Czechia': { lat: 50.0755, lon: 14.4378 },
        'Denmark': { lat: 55.6761, lon: 12.5683 },
        'Djibouti': { lat: 11.8251, lon: 42.5903 },
        'Dominica': { lat: 15.3050, lon: -61.3790 },
        'Dominican Republic': { lat: 18.4861, lon: -69.9309 },
        'DR Congo': { lat: -4.4419, lon: 15.2663 },
        'Ecuador': { lat: -0.1807, lon: -78.4678 },
        'Egypt': { lat: 30.0333, lon: 31.2333 },
        'El Salvador': { lat: 13.6929, lon: -89.2182 },
        'Equatorial Guinea': { lat: 3.7500, lon: 8.7833 },
        'Eritrea': { lat: 15.3229, lon: 38.9250 },
        'Estonia': { lat: 59.4370, lon: 24.7536 },
        'Eswatini': { lat: -26.3055, lon: 31.1367 },
        'Ethiopia': { lat: 9.0000, lon: 38.7500 },
        'Fiji': { lat: -18.1416, lon: 178.4419 },
        'Finland': { lat: 60.1699, lon: 24.9384 },
        'France': { lat: 48.8566, lon: 2.3522 },
        'Gabon': { lat: 0.3900, lon: 9.4535 },
        'Gambia': { lat: 13.4549, lon: -16.5790 },
        'Georgia': { lat: 41.7151, lon: 44.8271 },
        'Germany': { lat: 52.5200, lon: 13.4050 },
        'Ghana': { lat: 5.5560, lon: -0.1969 },
        'Greece': { lat: 37.9838, lon: 23.7275 },
        'Grenada': { lat: 12.0561, lon: -61.7423 },
        'Guatemala': { lat: 14.6349, lon: -90.5069 },
        'Guinea': { lat: 9.9456, lon: -13.7122 },
        'Guinea-Bissau': { lat: 11.8823, lon: -15.6322 },
        'Guyana': { lat: 6.8029, lon: -58.1565 },
        'Haiti': { lat: 18.5912, lon: -72.3075 },
        'Honduras': { lat: 14.0818, lon: -87.2068 },
        'Hungary': { lat: 47.4979, lon: 19.0402 },
        'Iceland': { lat: 64.1265, lon: -21.8174 },
        'India': { lat: 28.6139, lon: 77.2090 },
        'Indonesia': { lat: -6.1754, lon: 106.8272 },
        'Iran': { lat: 35.6892, lon: 51.3890 },
        'Iraq': { lat: 33.3152, lon: 44.3661 },
        'Ireland': { lat: 53.3498, lon: -6.2603 },
        'Israel': { lat: 31.7683, lon: 35.2137 },
        'Italy': { lat: 41.9028, lon: 12.4964 },
        'Ivory Coast': { lat: 6.8243, lon: -5.2896 },
        'Jamaica': { lat: 18.0179, lon: -76.8099 },
        'Japan': { lat: 35.6895, lon: 139.6917 },
        'Jordan': { lat: 31.9454, lon: 35.9284 },
        'Kazakhstan': { lat: 51.1694, lon: 71.4491 },
        'Kenya': { lat: -1.2921, lon: 36.8219 },
        'Kiribati': { lat: 1.3323, lon: 172.9808 },
        'Kuwait': { lat: 29.3759, lon: 47.9781 },
        'Kyrgyzstan': { lat: 42.8746, lon: 74.5698 },
        'Laos': { lat: 17.9748, lon: 102.6308 },
        'Latvia': { lat: 56.9496, lon: 24.1052 },
        'Lebanon': { lat: 33.8938, lon: 35.5018 },
        'Lesotho': { lat: -29.3100, lon: 27.4800 },
        'Liberia': { lat: 6.3000, lon: -10.8000 },
        'Libya': { lat: 32.8872, lon: 13.5887 },
        'Liechtenstein': { lat: 47.1337, lon: 9.5167 },
        'Lithuania': { lat: 54.6872, lon: 25.2797 },
        'Luxembourg': { lat: 49.6117, lon: 6.1319 },
        'Madagascar': { lat: -18.9137, lon: 47.5361 },
        'Malawi': { lat: -13.9669, lon: 33.7700 },
        'Malaysia': { lat: 3.1408, lon: 101.6930 },
        'Maldives': { lat: 4.1755, lon: 73.5093 },
        'Mali': { lat: 12.6392, lon: -7.9998 },
        'Malta': { lat: 35.8989, lon: 14.5145 },
        'Marshall Islands': { lat: 7.1158, lon: 171.3853 },
        'Mauritania': { lat: 18.0735, lon: -15.9329 },
        'Mauritius': { lat: -20.1619, lon: 57.5020 },
        'Mexico': { lat: 19.4326, lon: -99.1332 },
        'Micronesia': { lat: 6.9174, lon: 158.1539 },
        'Moldova': { lat: 47.0167, lon: 28.8500 },
        'Monaco': { lat: 43.7384, lon: 7.4246 },
        'Mongolia': { lat: 47.9212, lon: 106.9186 },
        'Montenegro': { lat: 42.4300, lon: 19.2600 },
        'Morocco': { lat: 34.0209, lon: -6.8416 },
        'Mozambique': { lat: -25.9653, lon: 32.5833 },
        'Myanmar': { lat: 19.7431, lon: 96.1115 },
        'Namibia': { lat: -22.5594, lon: 17.0832 },
        'Nauru': { lat: -0.5477, lon: 166.9208 },
        'Nepal': { lat: 27.7172, lon: 85.3240 },
        'Netherlands': { lat: 52.3676, lon: 4.9041 },
        'New Zealand': { lat: -41.2865, lon: 174.7762 },
        'Nicaragua': { lat: 12.1364, lon: -85.2072 },
        'Niger': { lat: 13.5115, lon: 2.1254 },
        'Nigeria': { lat: 9.0765, lon: 7.3986 },
        'North Korea': { lat: 39.0333, lon: 125.7500 },
        'North Macedonia': { lat: 41.9981, lon: 21.4254 },
        'Norway': { lat: 59.9139, lon: 10.7522 },
        'Oman': { lat: 23.5859, lon: 58.3820 },
        'Pakistan': { lat: 33.7214, lon: 73.0544 },
        'Palau': { lat: 7.3598, lon: 134.4608 },
        'Panama': { lat: 8.9824, lon: -79.5199 },
        'Papua New Guinea': { lat: -9.4438, lon: 147.1803 },
        'Paraguay': { lat: -25.2637, lon: -57.5759 },
        'Peru': { lat: -12.0464, lon: -77.0428 },
        'Philippines': { lat: 14.5995, lon: 120.9842 },
        'Poland': { lat: 52.2297, lon: 21.0122 },
        'Portugal': { lat: 38.7223, lon: -9.1393 },
        'Qatar': { lat: 25.2854, lon: 51.5310 },
        'Romania': { lat: 44.4268, lon: 26.1025 },
        'Russia': { lat: 55.7558, lon: 37.6173 },
        'Rwanda': { lat: -1.9403, lon: 30.0594 },
        'Saint Kitts and Nevis': { lat: 17.3000, lon: -62.7333 },
        'Saint Lucia': { lat: 14.0100, lon: -60.9884 },
        'Saint Vincent and the Grenadines': { lat: 13.1500, lon: -61.2000 },
        'Samoa': { lat: -13.8333, lon: -171.7667 },
        'San Marino': { lat: 43.9424, lon: 12.4578 },
        'Sao Tome and Principe': { lat: 0.3366, lon: 6.7336 },
        'Saudi Arabia': { lat: 24.7136, lon: 46.6753 },
        'Senegal': { lat: 14.7167, lon: -17.4677 },
        'Serbia': { lat: 44.7874, lon: 20.4573 },
        'Seychelles': { lat: -4.6167, lon: 55.4500 },
        'Sierra Leone': { lat: 8.4844, lon: -13.2344 },
        'Singapore': { lat: 1.3521, lon: 103.8198 },
        'Slovakia': { lat: 48.1486, lon: 17.1077 },
        'Slovenia': { lat: 46.0569, lon: 14.5058 },
        'Solomon Islands': { lat: -9.4333, lon: 159.9500 },
        'Somalia': { lat: 2.0407, lon: 45.3435 },
        'South Africa': { lat: -25.7479, lon: 28.2293 },
        'South Korea': { lat: 37.5665, lon: 126.9780 },
        'South Sudan': { lat: 4.8500, lon: 31.6000 },
        'Spain': { lat: 40.4168, lon: -3.7038 },
        'Sri Lanka': { lat: 6.9027, lon: 79.9191 },
        'Sudan': { lat: 15.5007, lon: 32.5599 },
        'Suriname': { lat: 5.8234, lon: -55.1679 },
        'Sweden': { lat: 59.3293, lon: 18.0686 },
        'Switzerland': { lat: 46.9480, lon: 7.4474 },
        'Syria': { lat: 33.5132, lon: 36.2913 },
        'Tajikistan': { lat: 38.5604, lon: 68.7753 },
        'Tanzania': { lat: -6.1631, lon: 35.7458 },
        'Thailand': { lat: 13.7563, lon: 100.5018 },
        'Timor-Leste': { lat: -8.5583, lon: 125.5600 },
        'Togo': { lat: 6.1367, lon: 1.2223 },
        'Tonga': { lat: -21.1333, lon: -175.2000 },
        'Trinidad and Tobago': { lat: 10.6667, lon: -61.5167 },
        'Tunisia': { lat: 36.8065, lon: 10.1815 },
        'Turkey': { lat: 39.9334, lon: 32.8597 },
        'Turkmenistan': { lat: 37.9653, lon: 58.3797 },
        'Tuvalu': { lat: -8.6500, lon: 179.1900 },
        'Uganda': { lat: 0.3476, lon: 32.5825 },
        'Ukraine': { lat: 50.4501, lon: 30.5234 },
        'United Arab Emirates': { lat: 24.4539, lon: 54.3773 },
        'United Kingdom': { lat: 51.5074, lon: -0.1278 },
        'United States': { lat: 38.9072, lon: -77.0369 },
        'Uruguay': { lat: -34.9011, lon: -56.1645 },
        'Uzbekistan': { lat: 41.2995, lon: 69.2401 },
        'Vanuatu': { lat: -17.7400, lon: 168.3200 },
        'Venezuela': { lat: 10.4806, lon: -66.9036 },
        'Vietnam': { lat: 21.0285, lon: 105.8542 },
        'Yemen': { lat: 15.3694, lon: 44.1910 },
        'Zambia': { lat: -15.4167, lon: 28.2833 },
        'Zimbabwe': { lat: -17.8252, lon: 31.0335 }
    };

    // --- Create Sign ---
    function createSign(label,distance,angleDeg,y=1.5){
      const sign=new THREE.Group();
      const signW=2.6, signH=0.52, signD=0.05; const xCenter=1.5;
      const shape=new THREE.Shape(); shape.moveTo(0,-signH/2); shape.lineTo(signW-0.4,-signH/2); shape.lineTo(signW,0); shape.lineTo(signW-0.4,signH/2); shape.lineTo(0,signH/2); shape.closePath();
      const geom=new THREE.ExtrudeGeometry(shape,{depth:signD,bevelEnabled:false}); const body=new THREE.Mesh(geom,new THREE.MeshStandardMaterial({color:0xffffff}));
      const angleRad=THREE.MathUtils.degToRad(-angleDeg); sign.rotation.y=angleRad+Math.PI/2; body.position.set(xCenter-signW/2,y,-signD/2); sign.add(body);
      const dir = new THREE.Vector3(Math.sin(angleRad), 0, Math.cos(angleRad));
            // always use same color scheme for country signs
      const colors = ['#222033','#c62e5f'];
      const {tex:frontTex,fontSize} = makeTextTexture(label,distance,1024,256,colors[0],colors[1],'left');
      const textGeom=new THREE.PlaneGeometry(signW*0.8,signH*0.9); 
      const frontTextMat=new THREE.MeshBasicMaterial({map:frontTex,transparent:true});
      const frontText=new THREE.Mesh(textGeom,frontTextMat); frontText.position.set(xCenter,y,0.03); sign.add(frontText);  

      const {tex:backTex} = makeTextTexture(label,distance,1024,256,colors[0],colors[1],'right');
      const backText=new THREE.Mesh(textGeom,new THREE.MeshBasicMaterial({map:backTex,transparent:true})); backText.position.set(xCenter,y,-0.03); backText.rotation.y=Math.PI; sign.add(backText);

      const pin = new THREE.Mesh(new THREE.CylinderGeometry(0.016,0.016,0.5,8), new THREE.MeshStandardMaterial({color:0x222033})); pin.rotation.z = Math.PI/2; pin.position.set(0.22,y,0); sign.add(pin);
      const flagUrl = getFlagUrl(label);
      if(flagUrl){ createFlagCircleTexture(flagUrl, Math.max(32, Math.round(fontSize)), (flagTex)=>{ if(!flagTex) return; const flagMat=new THREE.MeshBasicMaterial({map:flagTex,transparent:true}); const worldRadius=(fontSize/512);
        const frontFlag=new THREE.Mesh(new THREE.CircleGeometry(worldRadius,64),flagMat); frontFlag.position.set(signW-0.4,y,0.06); sign.add(frontFlag);
        const backFlag=new THREE.Mesh(new THREE.CircleGeometry(worldRadius,64),flagMat); backFlag.position.set(signW-0.4,y,-0.06); backFlag.rotation.y=Math.PI; sign.add(backFlag);                             
      }); }
      return sign;                            
    }

    // inside createSign, after building the shape


        // --- Compass ring (dashed) + labels ---
    const signLength = 2.6; const compassRadius = signLength * 4; const segments = 256; const points = [];
    for(let i=0;i<=segments;i++){ const theta = (i/segments) * Math.PI * 2; points.push(new THREE.Vector3(Math.cos(theta)*compassRadius,0,Math.sin(theta)*compassRadius)); }
    const ringGeom = new THREE.BufferGeometry().setFromPoints(points); const ringMat = new THREE.LineDashedMaterial({color:0x444444,dashSize:0.2,gapSize:0.1,linewidth:2}); const compassCircle = new THREE.LineLoop(ringGeom, ringMat); compassCircle.computeLineDistances(); compassCircle.rotation.x = -Math.PI/1; compassCircle.position.y = 3 * 1.3; root.add(compassCircle);
    
    function makeCompassLabel(text,scale=5,color='#fff'){ const base=256; const canvas=document.createElement('canvas'); canvas.width=canvas.height=base*scale; const ctx=canvas.getContext('2d'); ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='rgba(255,255,255,0)'; ctx.fillRect(0,0,canvas.width,canvas.height); ctx.fillStyle=color; const fontSize=100*scale; ctx.font = fontSize + 'px "Bebas Neue"'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(text, canvas.width/2, canvas.height/2); const tex=new THREE.CanvasTexture(canvas); tex.needsUpdate=true; return { material: new THREE.MeshBasicMaterial({ map: tex, transparent:true, side: THREE.DoubleSide }), size: scale }; }

    const directions = [ ['N',180,'#d6e160',5], ['W',90,'#fff',5], ['S',0,'#fff',5], ['E',270,'#fff',5], ['NE',225,'#fff',2.5], ['NW',135,'#fff',2.5], ['SE',315,'#fff',2.5], ['SW',45,'#fff',2.5] ];
    directions.forEach(([label,angle,color,scale])=>{
      const { material: texMat, size } = makeCompassLabel(label, scale, color);
      const planeSize = 1 * size;
      const textPlane = new THREE.Mesh(new THREE.PlaneGeometry(planeSize, planeSize), texMat);
      const rad = THREE.MathUtils.degToRad(angle);
      const outwardRadius = compassRadius + planeSize;
      const letterHeight = planeSize;
      textPlane.position.set(Math.sin(rad) * outwardRadius, 3*2 + letterHeight*0.5, Math.cos(rad) * outwardRadius);
      textPlane.rotation.y = Math.PI / 2;
      if(label === 'N') textPlane.rotation.y += Math.PI / 0.666;
      if(label === 'S') textPlane.rotation.y += Math.PI / 2;
      if(label === 'SW') textPlane.rotation.y += Math.PI / 0.36;
      if(label === 'SE') textPlane.rotation.y += Math.PI / 0.16;
      if(label === 'NE') textPlane.rotation.y += Math.PI / 0.56;
      if(label === 'NW') textPlane.rotation.y += Math.PI / 0.76;
      root.add(textPlane);  

      // arrow
      const arrowHeight = letterHeight * 0.1;
      const arrowShape = new THREE.Shape(); arrowShape.moveTo(0,0); arrowShape.lineTo(arrowHeight*0.5,-arrowHeight); arrowShape.lineTo(-arrowHeight*0.5,-arrowHeight); arrowShape.closePath();
      const arrowGeom = new THREE.ShapeGeometry(arrowShape); const arrowMat = new THREE.MeshBasicMaterial({ color: label === 'N' ? '#d6e160' : '#ffffff', side: THREE.DoubleSide });
      const arrow = new THREE.Mesh(arrowGeom, arrowMat);
      arrow.rotation.x = -Math.PI/2; arrow.rotation.y = textPlane.rotation.y; arrow.rotation.x = textPlane.rotation.x;
      arrow.position.set(textPlane.position.x, textPlane.position.y + letterHeight*0.4, textPlane.position.z);
      root.add(arrow);
    });

    // --- Country pool ---
    const customCountries = ["Afghanistan","Albania","Algeria","Andorra","Angola","Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burundi","Cabo Verde","Cambodia","Cameroon","Canada","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo","Costa Rica","Croatia","Cuba","Cyprus","Czechia","Denmark","Djibouti","Dominica","Dominican Republic","DR Congo","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Eswatini","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Germany","Ghana","Greece","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Ivory Coast","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Monaco","Mongolia","Montenegro","Morocco","Mozambique","Myanmar","Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","North Korea","North Macedonia","Norway","Oman","Pakistan","Palau","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Rwanda","Saint Kitts and Nevis","Saint Lucia","Saint Vincent and the Grenadines","Samoa","San Marino","Sao Tome and Principe","Saudi Arabia","Senegal","Serbia","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","South Korea","South Sudan","Spain","Sri Lanka","Sudan","Suriname","Sweden","Switzerland","Syria","Tajikistan","Tanzania","Thailand","Timor-Leste","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Tuvalu","Uganda","Ukraine","United Arab Emirates","United Kingdom","United States","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"];

    const nameToUpper = new Map();
    customCountries.forEach(n=>nameToUpper.set(n.toUpperCase(), n));

    // --- Geodesic helpers (haversine + bearing) ---
    function toRad(deg){ return deg * Math.PI / 180; }
    function toDeg(rad){ return rad * 180 / Math.PI; }
    function haversineDistance(lat1,lon1,lat2,lon2){
      const R = 6371; // km
      const dLat = toRad(lat2-lat1);
      const dLon = toRad(lon2-lon1);
      const a = Math.sin(dLat/2)*Math.sin(dLat/2) + Math.cos(toRad(lat1))*Math.cos(toRad(lat2)) * Math.sin(dLon/2)*Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }
    // initial bearing from point A to B (0 = north)
    function bearingDeg(lat1,lon1,lat2,lon2){
      const y = Math.sin(toRad(lon2-lon1)) * Math.cos(toRad(lat2));
      const x = Math.cos(toRad(lat1))*Math.sin(toRad(lat2)) - Math.sin(toRad(lat1))*Math.cos(toRad(lat2))*Math.cos(toRad(lon2-lon1));
      return (toDeg(Math.atan2(y,x)) + 360) % 360;
    }

  // --- Modified setupRound with difficulty tiers ---
    function setupRound(numSigns=10){
      const pool = [...customCountries];
      // pick correct answer
      const correctIndex = Math.floor(Math.random()*pool.length);
      const correct = pool.splice(correctIndex,1)[0];
      const correctCoord = COUNTRY_COORDINATES[correct];

      // compute distances from correct to all others
      const distList = pool.map(c => {
        const coord = COUNTRY_COORDINATES[c];
        if(!correctCoord || !coord) return {country:c, dist:Infinity, bearing:Math.floor(Math.random()*360)};
        return { country:c, dist:haversineDistance(correctCoord.lat, correctCoord.lon, coord.lat, coord.lon), bearing: bearingDeg(correctCoord.lat, correctCoord.lon, coord.lat, coord.lon) };
      });
      // sort by distance ascending
      distList.sort((a,b)=>a.dist-b.dist);

      const signs = [];
      function pickFromRange(startFrac, endFrac, count){
        const start = Math.floor(distList.length * startFrac);
        const end = Math.floor(distList.length * endFrac);
        for(let i=0; i<count && (end-start)>0; i++){
          const idx = Math.floor(Math.random()*(end-start))+start;
          const {country, dist, bearing} = distList.splice(idx,1)[0];
          signs.push([country.toUpperCase(), Math.round(dist)+" km", Math.round(bearing)]);
        }
      }
      // tiers: 1-2 from farthest 50%
      pickFromRange(0.5, 1.0, 2);
      // 3-5 from 25-50% closest
      pickFromRange(0.25, 0.5, 3);
      // 6-7 from 10-25% closest
      pickFromRange(0.10, 0.25, 2);
      // 8-10 from 0-10% closest
      pickFromRange(0.0, 0.10, 3);

      return { correct: correct.toUpperCase(), signs };
    }

    const { correct, signs } = setupRound(10);
    

    // build sign meshes
    let yStart = 3.4;
    const signMeshes = signs.map((c,i)=>createSign(c[0],c[1],c[2], yStart - i*0.45));
    let revealedCount = 1;
    root.add(signMeshes[0]);
    const maxReveals = signMeshes.length;

    // --- UI ---
const input = document.getElementById('guessInput');
const button = document.getElementById('guessButton');
const suggestionsBox = document.getElementById('suggestions');
const messageEl = document.getElementById('message');

// add this (declare before handleGuess)
let lastSelected = null;


    function showMessage(txt,timeout=2000){
      messageEl.style.display = 'block';
      messageEl.textContent = txt;
      if(timeout){
        clearTimeout(showMessage._t);
        showMessage._t = setTimeout(()=>{
          messageEl.style.display = 'none';
        }, timeout);
      }
    }

    function normalize(s){ return (s||'').trim().toUpperCase(); }

function handleGuess(){
      const raw = input.value;
      if(!lastSelected || raw !== lastSelected){
        showMessage('Please select a country from the list by clicking it.');
        return;
      }

      const g = normalize(raw);
      if(g === correct){
        for(let i = revealedCount; i < signMeshes.length; i++) root.add(signMeshes[i]);
        revealedCount = signMeshes.length;
        const properName = nameToUpper.get(g) || g;
        endGame('Correct — the pole is in ' + properName + '!');
      } else {
        // create a new sign dynamically for the failed guess
        const failedCountry = nameToUpper.get(g) || g;
        const correctCoord = COUNTRY_COORDINATES[nameToUpper.get(correct) || correct];
        const guessCoord = COUNTRY_COORDINATES[failedCountry]; 
        let dist = 0, bearing = Math.floor(Math.random()*360);
        if(correctCoord && guessCoord){
          dist = Math.round(haversineDistance(correctCoord.lat, correctCoord.lon, guessCoord.lat, guessCoord.lon));
          bearing = Math.round(bearingDeg(correctCoord.lat, correctCoord.lon, guessCoord.lat, guessCoord.lon));
        }
        const newSign = createSign(failedCountry.toUpperCase(), dist + " km", bearing, 3.4 - revealedCount*0.55);
        signMeshes.push(newSign);
        root.add(newSign);
        revealedCount++;

        if(revealedCount >= maxReveals){
          const properCorrect = nameToUpper.get(correct) || correct;
          endGame('Game over — the location was: ' + properCorrect);
        } else {
          showMessage('No — keep trying.');
        }
      }
      input.value = '';
      suggestionsBox.style.display = 'none';
      lastSelected = null;
    }

    button.addEventListener('click', handleGuess);
    input.addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ handleGuess(); } });

    // suggestions (contains, not startsWith)
    input.addEventListener('input', ()=>{
      const val = normalize(input.value);
      suggestionsBox.innerHTML = '';
      if(!val){ suggestionsBox.style.display = 'none'; return; }
      const matches = customCountries.filter(n => n.toUpperCase().includes(val));
      if(matches.length){
        suggestionsBox.style.display = 'block';
        matches.slice(0,12).forEach(name=>{
          const d=document.createElement('div');
          d.textContent = name;
          d.tabIndex = 0;
          d.addEventListener('click', () => {
  input.value = name;
  suggestionsBox.style.display = 'none';
  input.focus();
  lastSelected = name; // << add this so handleGuess can verify
});

          d.addEventListener('keydown',(e)=>{
            if(e.key==='Enter'){
              input.value = name;
              suggestionsBox.style.display='none';
              input.focus();
              lastSelected = name; // track selection 
            }
          });
          suggestionsBox.appendChild(d);
        });
      } else {
        suggestionsBox.style.display = 'none';
      }
    });

    document.addEventListener('click', (e)=>{
      if(!e.target.closest('#suggestions') && !e.target.closest('#guessInput')) suggestionsBox.style.display = 'none';
    });


    // --- Drag to rotate ---
    let dragging=false, startX=0, startRot=0; function getX(e){ return e.touches && e.touches.length ? e.touches[0].clientX : e.clientX; }
    renderer.domElement.addEventListener('pointerdown', (e)=>{ dragging=true; startX=getX(e); startRot=root.rotation.y; renderer.domElement.setPointerCapture(e.pointerId); document.body.style.cursor='grabbing'; });
    window.addEventListener('pointermove', (e)=>{ if(!dragging) return; const dx = getX(e) - startX; root.rotation.y = startRot + (dx / window.innerWidth) * Math.PI; });
    window.addEventListener('pointerup', ()=>{ dragging=false; document.body.style.cursor=''; });

    // --- Render ---
    function animate(){ requestAnimationFrame(animate); renderer.render(scene,camera); } animate();
    window.addEventListener('resize', ()=>{ camera.aspect = innerWidth / innerHeight; camera.updateProjectionMatrix(); renderer.setSize(innerWidth, innerHeight); });

    const playAgainButton = document.getElementById('playAgainButton');

    function endGame(message) {
      showMessage(message);
      input.disabled = true;
      button.disabled = true;
      playAgainButton.style.display = 'inline-block';
    }

    function resetGame(){
      window.location.reload();
    }

    playAgainButton.addEventListener('click', resetGame);


  </script>
</body>
</html>
